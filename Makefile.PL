use ExtUtils::MakeMaker;

#---------------------------------------------------------------------
if ($] < 5.006) {
  print STDERR <<"";
This Makefile.PL requires Perl 5.6 or better.
Use Win32::Setupsup 1.01 with older versions of Perl:
  http://www.cpan.org/modules/by-module/Win32/setupsup.1.0.1.0.zip

  exit 1;
} # end if version too small

#---------------------------------------------------------------------
my $mm = WriteMakefile(
 NAME           => 'Win32::Setupsup',
 AUTHOR         => 'Jens Helberg (jens.helberg@de.bosch.com)',
 ABSTRACT       => 'Remote control for windows applications.',
 DEFINE         => '-DPERL_5_6_0',
 OBJECT => 'list.obj misc.obj plmisc.obj setupsup.obj wstring.obj resource.res',
 PREREQ_PM      => { 'Win32::Registry' => 0 },
 'VERSION_FROM' => 'Setupsup.pm', # finds $VERSION
);

#---------------------------------------------------------------------
print "Exporting version number to afxres.h\n";

my $version = $mm->{VERSION};
$version =~ /^(\d+)\.(\d+)(\d)/ or die "Can't understand version '$version'";
my $versionnum = "$1,$2,$3,0";

open(VER, '>afxres.h') or die "Can't create afxres.h: $!";
print VER <<"";
// This file was automatically generated by Makefile.PL\n
#include "winres.h"\n
#define SETUPSUP_VERSION    "$version"
#define SETUPSUP_VERSION_NUM $versionnum

close VER;
